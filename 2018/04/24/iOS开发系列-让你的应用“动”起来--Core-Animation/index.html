<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword" content="">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png">
    <link rel="alternate" type="application/atom+xml" title="Kasign" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        iOS开发系列-让你的应用“动”起来--Core-Animation｜undefined
        
    </title>

    <link rel="canonical" href="https://kasign.github.io/2018/04/24/iOS开发系列-让你的应用“动”起来--Core-Animation/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="../../../../css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../../../../css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="../../../../css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Kasign
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/tags/">tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="/img/post-default.jpg">


<style>
    
    header.intro-header {
        background-image: url('/img/post-default.jpg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>iOS开发系列-让你的应用“动”起来--Core-Animation</h1>
                    
                    <span class="meta">
                         作者 Kasign
                        <span>
                          日期 2018-04-24
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title">
        <span>
            iOS开发系列-让你的应用“动”起来--Core-Animation
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <p>大家都知道在iOS中实现一个动画相当简单，只要调用UIView的块代码即可实现一个动画效果，这在其他系统开发中基本不可能实现。下面通过一个简单的UIView进行一个图片放大动画效果演示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    UIImage *image=[UIImage imageNamed:@&quot;open2.png&quot;];</span><br><span class="line">    UIImageView *imageView=[[UIImageView alloc]init];</span><br><span class="line">    imageView.image=image;</span><br><span class="line">    imageView.frame=CGRectMake(120, 140, 80, 80);</span><br><span class="line">    [self.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    //两秒后开始一个持续一分钟的动画</span><br><span class="line">    [UIView animateWithDuration:1 delay:2 options:UIViewAnimationOptionBeginFromCurrentState animations:^&#123;</span><br><span class="line">        imageView.frame=CGRectMake(80, 100, 160, 160);</span><br><span class="line">    &#125; completion:nil];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>使用上面UIView封装的方法进行动画设置固然十分方便，但是具体动画如何实现我们是不清楚的，而且上面的代码还有一些问题是无法解决的，例如：如何控制动画的暂停？如何进行动画的组合？？？</p>
<p>这里就需要了解iOS的核心动画Core Animation（包含在Quartz Core框架中）。在iOS中核心动画分为几类：基础动画、关键帧动画、动画组、转场动画。各个类的关系大致如下：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-36092b5328dbce1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li><p>CAAnimation：核心动画的基础类，不能直接使用，负责动画运行时间、速度的控制，本身实现了CAMediaTiming协议。</p>
</li>
<li><p>CAPropertyAnimation：属性动画的基类（通过属性进行动画设置，注意是可动画属性），不能直接使用。</p>
</li>
<li><p>CAAnimationGroup：动画组，动画组是一种组合模式设计，可以通过动画组来进行所有动画行为的统一控制，组中所有动画效果可以并发执行。</p>
</li>
<li><p>CATransition：转场动画，主要通过滤镜进行动画效果设置。</p>
</li>
<li><p>CABasicAnimation：基础动画，通过属性修改进行动画参数控制，只有初始状态和结束状态。</p>
</li>
<li><p>CAKeyframeAnimation：关键帧动画，同样是通过属性进行动画参数控制，但是同基础动画不同的是它可以有多个状态控制。</p>
</li>
</ul>
<p>基础动画、关键帧动画都属于属性动画，就是通过修改属性值产生动画效果，开发人员只需要设置初始值和结束值，中间的过程动画（又叫“补间动画”）由系统自动计算产生。和基础动画不同的是关键帧动画可以设置多个属性值，每两个属性中间的补间动画由系统自动完成，因此从这个角度而言基础动画又可以看成是有两个关键帧的关键帧动画。</p>
<p>#基础动画</p>
<p>在开发过程中很多情况下通过基础动画就可以满足开发需求，前面例子中使用的UIView代码块进行图像放大缩小的演示动画也是基础动画（在iOS7中UIView也对关键帧动画进行了封装），只是UIView装饰方法隐藏了更多的细节。如果不使用UIView封装的方法，动画创建一般分为以下几步：</p>
<ol>
<li>初始化动画并设置动画属性</li>
<li>设置动画属性初始值（可以省略）、结束值以及其他动画属性</li>
<li>给图层添加动画</li>
</ol>
<p>下面以一个移动动画为例进行演示，在这个例子中点击屏幕哪个位置落花将飞向哪里。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line">    </span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[CALayer layer];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 移动动画</span><br><span class="line">-(void)translatonAnimation:(CGPoint)location&#123;</span><br><span class="line">    //1.创建动画并指定动画属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画属性初始值和结束值</span><br><span class="line">//    basicAnimation.fromValue=[NSNumber numberWithInteger:50];//可以不设置，默认为图层初始状态</span><br><span class="line">    basicAnimation.toValue=[NSValue valueWithCGPoint:location];</span><br><span class="line">    </span><br><span class="line">    //设置其他动画属性</span><br><span class="line">    basicAnimation.duration=5.0;//动画时间5秒</span><br><span class="line">    //basicAnimation.repeatCount=HUGE_VALF;//设置重复次数,HUGE_VALF可看做无穷大，起到循环动画的效果</span><br><span class="line">    //    basicAnimation.removedOnCompletion=NO;//运行一次是否移除动画</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    //3.添加动画到图层，注意key相当于给动画进行命名，以后获得该动画时可以使用此名称获取</span><br><span class="line">    [_layer addAnimation:basicAnimation forKey:@&quot;KCBasicAnimation_Translation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 点击事件</span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    UITouch *touch=touches.anyObject;</span><br><span class="line">    CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    //创建并开始动画</span><br><span class="line">    [self translatonAnimation:location];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>运行效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-b9a0bf42a4083205.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>上面实现了一个基本动画效果，但是这个动画存在一个问题：动画结束后动画图层回到了原来的位置，当然是用UIView封装的方法是没有这个问题的。如何解决这个问题呢？</p>
<p>图层动画的本质就是将图层内部的内容转化为位图经硬件操作形成一种动画效果，其实图层本身并没有任何的变化。上面的动画中图层并没有因为动画效果而改变它的位置（对于缩放动画其大小也是不会改变的），所以动画完成之后图层还是在原来的显示位置没有任何变化，如果这个图层在一个UIView中你会发现在UIView移动过程中你要触发UIView的点击事件也只能点击原来的位置（即使它已经运动到了别的位置），因为它的位置从来没有变过。当然解决这个问题方法比较多，这里不妨在动画完成之后重新设置它的位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// </span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&lt;CAAnimationDelegate&gt;&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line">    </span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 移动动画</span><br><span class="line">-(void)translatonAnimation:(CGPoint)location&#123;</span><br><span class="line">    //1.创建动画并指定动画属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画属性初始值和结束值</span><br><span class="line">//    basicAnimation.fromValue=[NSNumber numberWithInteger:50];//可以不设置，默认为图层初始状态</span><br><span class="line">    basicAnimation.toValue=[NSValue valueWithCGPoint:location];</span><br><span class="line">    </span><br><span class="line">    //设置其他动画属性</span><br><span class="line">    basicAnimation.duration=5.0;//动画时间5秒</span><br><span class="line">    //basicAnimation.repeatCount=HUGE_VALF;//设置重复次数,HUGE_VALF可看做无穷大，起到循环动画的效果</span><br><span class="line">    //    basicAnimation.removedOnCompletion=NO;//运行一次是否移除动画</span><br><span class="line">    basicAnimation.delegate=self;</span><br><span class="line">    //存储当前位置在动画结束后使用</span><br><span class="line">    [basicAnimation setValue:[NSValue valueWithCGPoint:location] forKey:@&quot;KCBasicAnimationLocation&quot;];</span><br><span class="line">    </span><br><span class="line">    //3.添加动画到图层，注意key相当于给动画进行命名，以后获得该动画时可以使用此名称获取</span><br><span class="line">    [_layer addAnimation:basicAnimation forKey:@&quot;KCBasicAnimation_Translation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 点击事件</span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    UITouch *touch=touches.anyObject;</span><br><span class="line">    CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    //创建并开始动画</span><br><span class="line">    [self translatonAnimation:location];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 动画代理方法</span><br><span class="line">#pragma mark 动画开始</span><br><span class="line">-(void)animationDidStart:(CAAnimation *)anim&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) start.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    NSLog(@&quot;%@&quot;,[_layer animationForKey:@&quot;KCBasicAnimation_Translation&quot;]);//通过前面的设置的key获得动画</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 动画结束</span><br><span class="line">-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) stop.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    _layer.position=[[anim valueForKey:@&quot;KCBasicAnimationLocation&quot;] CGPointValue];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>上面通过给动画设置一个代理去监听动画的开始和结束事件，在动画开始前给动画添加一个自定义属性“KCBasicAnimationLocation”存储动画终点位置，然后在动画结束后设置动画的位置为终点位置。</p>
<p>如果运行上面的代码大家可能会发现另外一个问题，那就是动画运行完成后会重新从起始点运动到终点。这个问题产生的原因就是前面提到的，对于非根图层，设置图层的可动画属性（在动画结束后重新设置了position，而position是可动画属性）会产生动画效果。解决这个问题有两种办法：关闭图层隐式动画、设置动画图层为根图层。显然这里不能采取后者，因为根图层当前已经作为动画的背景。</p>
<p>要关闭隐式动画需要用到动画事务CATransaction，在事务内将隐式动画关闭，例如上面的代码可以改为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark 动画结束</span><br><span class="line">-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) stop.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    //开启事务</span><br><span class="line">    [CATransaction begin];</span><br><span class="line">    //禁用隐式动画</span><br><span class="line">    [CATransaction setDisableActions:YES];</span><br><span class="line">    </span><br><span class="line">    _layer.position=[[anim valueForKey:@&quot;KCBasicAnimationLocation&quot;] CGPointValue];</span><br><span class="line">    </span><br><span class="line">    //提交事务</span><br><span class="line">    [CATransaction commit];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然上面的动画还显得有些生硬，因为落花飘散的时候可能不仅仅是自由落体运动，本身由于空气阻力、外界风力还会造成落花在空中的旋转、摇摆等，这里不妨给图层添加一个旋转的动画。对于图层的旋转通过key path设置图层旋转的内容，在这里需要强调一下，图层的形变都是基于锚点进行的。例如旋转，旋转的中心点就是图层的锚点。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line">    </span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.anchorPoint=CGPointMake(0.5, 0.6);//设置锚点</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 移动动画</span><br><span class="line">-(void)translatonAnimation:(CGPoint)location&#123;</span><br><span class="line">    //1.创建动画并指定动画属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画属性初始值、结束值</span><br><span class="line">//    basicAnimation.fromValue=[NSNumber numberWithInteger:50];//可以不设置，默认为图层初始状态</span><br><span class="line">    basicAnimation.toValue=[NSValue valueWithCGPoint:location];</span><br><span class="line">    </span><br><span class="line">    //设置其他动画属性</span><br><span class="line">    basicAnimation.duration=5.0;//动画时间5秒</span><br><span class="line">    //basicAnimation.repeatCount=HUGE_VALF;//设置重复次数,HUGE_VALF可看做无穷大，起到循环动画的效果</span><br><span class="line">    //    basicAnimation.removedOnCompletion=NO;//运行一次是否移除动画</span><br><span class="line">    basicAnimation.delegate=self;</span><br><span class="line">    //存储当前位置在动画结束后使用</span><br><span class="line">    [basicAnimation setValue:[NSValue valueWithCGPoint:location] forKey:@&quot;KCBasicAnimationLocation&quot;];</span><br><span class="line">    </span><br><span class="line">    //3.添加动画到图层，注意key相当于给动画进行命名，以后获得该图层时可以使用此名称获取</span><br><span class="line">    [_layer addAnimation:basicAnimation forKey:@&quot;KCBasicAnimation_Translation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 旋转动画</span><br><span class="line">-(void)rotationAnimation&#123;</span><br><span class="line">    //1.创建动画并指定动画属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;transform.rotation.z&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画属性初始值、结束值</span><br><span class="line">//    basicAnimation.fromValue=[NSNumber numberWithInt:M_PI_2];</span><br><span class="line">    basicAnimation.toValue=[NSNumber numberWithFloat:M_PI_2*3];</span><br><span class="line">    </span><br><span class="line">    //设置其他动画属性</span><br><span class="line">    basicAnimation.duration=6.0;</span><br><span class="line">    basicAnimation.autoreverses=true;//旋转后再旋转到原来的位置</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    //4.添加动画到图层，注意key相当于给动画进行命名，以后获得该动画时可以使用此名称获取</span><br><span class="line">    [_layer addAnimation:basicAnimation forKey:@&quot;KCBasicAnimation_Rotation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 点击事件</span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    UITouch *touch=touches.anyObject;</span><br><span class="line">    CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    //创建并开始动画</span><br><span class="line">    [self translatonAnimation:location];</span><br><span class="line">    </span><br><span class="line">    [self rotationAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 动画代理方法</span><br><span class="line">#pragma mark 动画开始</span><br><span class="line">-(void)animationDidStart:(CAAnimation *)anim&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) start.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    NSLog(@&quot;%@&quot;,[_layer animationForKey:@&quot;KCBasicAnimation_Translation&quot;]);//通过前面的设置的key获得动画</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 动画结束</span><br><span class="line">-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) stop.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    //开启事务</span><br><span class="line">    [CATransaction begin];</span><br><span class="line">    //禁用隐式动画</span><br><span class="line">    [CATransaction setDisableActions:YES];</span><br><span class="line">    </span><br><span class="line">    _layer.position=[[anim valueForKey:@&quot;KCBasicAnimationLocation&quot;] CGPointValue];</span><br><span class="line">    </span><br><span class="line">    //提交事务</span><br><span class="line">    [CATransaction commit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>上面代码中结合两种动画操作，需要注意的是只给移动动画设置了代理，在旋转动画中并没有设置代理，否则代理方法会执行两遍。由于旋转动画会无限循环执行（上面设置了重复次数无穷大），并且两个动画的执行时间没有必然的关系，这样一来移动停止后可能还在旋转，为了让移动动画停止后旋转动画停止就需要使用到动画的暂停和恢复方法。</p>
<p>核心动画的运行有一个媒体时间的概念，假设将一个旋转动画设置旋转一周用时60秒的话，那么当动画旋转90度后媒体时间就是15秒。如果此时要将动画暂停只需要让媒体时间偏移量设置为15秒即可，并把动画运行速度设置为0使其停止运动。类似的，如果又过了60秒后需要恢复动画（此时媒体时间为75秒），这时只要将动画开始开始时间设置为当前媒体时间75秒减去暂停时的时间（也就是之前定格动画时的偏移量）15秒（开始时间=75-15=60秒），那么动画就会重新计算60秒后的状态再开始运行，与此同时将偏移量重新设置为0并且把运行速度设置1。这个过程中真正起到暂停动画和恢复动画的其实是动画速度的调整，媒体时间偏移量以及恢复时的开始时间设置主要为了让动画更加连贯。</p>
<p>下面的代码演示了移动动画结束后旋转动画暂停，并且当再次点击动画时旋转恢复的过程(注意在移动过程中如果再次点击屏幕可以暂停移动和旋转动画，再次点击可以恢复两种动画。但是当移动结束后触发了移动动画的完成事件如果再次点击屏幕则只能恢复旋转动画，因为此时移动动画已经结束而不是暂停，无法再恢复)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line">    </span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.anchorPoint=CGPointMake(0.5, 0.6);//设置锚点</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark 移动动画</span><br><span class="line">-(void)translatonAnimation:(CGPoint)location&#123;</span><br><span class="line">    //1.创建动画并指定动画属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画属性初始值、结束值</span><br><span class="line">//    basicAnimation.fromValue=[NSNumber numberWithInteger:50];//可以不设置，默认为图层初始状态</span><br><span class="line">    basicAnimation.toValue=[NSValue valueWithCGPoint:location];</span><br><span class="line">    </span><br><span class="line">    //设置其他动画属性</span><br><span class="line">    basicAnimation.duration=5.0;//动画时间5秒</span><br><span class="line">//    basicAnimation.repeatCount=HUGE_VALF;//设置重复次数,HUGE_VALF可看做无穷大，起到循环动画的效果</span><br><span class="line">    basicAnimation.removedOnCompletion=NO;//运行一次是否移除动画</span><br><span class="line">    basicAnimation.delegate=self;</span><br><span class="line">    //存储当前位置在动画结束后使用</span><br><span class="line">    [basicAnimation setValue:[NSValue valueWithCGPoint:location] forKey:@&quot;KCBasicAnimationLocation&quot;];</span><br><span class="line">    </span><br><span class="line">    //3.添加动画到图层，注意key相当于给动画进行命名，以后获得该图层时可以使用此名称获取</span><br><span class="line">    [_layer addAnimation:basicAnimation forKey:@&quot;KCBasicAnimation_Translation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 旋转动画</span><br><span class="line">-(void)rotationAnimation&#123;</span><br><span class="line">    //1.创建动画并指定动画属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;transform.rotation.z&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画属性初始值、结束值</span><br><span class="line">//    basicAnimation.fromValue=[NSNumber numberWithInt:M_PI_2];</span><br><span class="line">    basicAnimation.toValue=[NSNumber numberWithFloat:M_PI_2*3];</span><br><span class="line">    </span><br><span class="line">    //设置其他动画属性</span><br><span class="line">    basicAnimation.duration=6.0;</span><br><span class="line">    basicAnimation.autoreverses=true;//旋转后在旋转到原来的位置</span><br><span class="line">    basicAnimation.repeatCount=HUGE_VALF;//设置无限循环</span><br><span class="line">    basicAnimation.removedOnCompletion=NO;</span><br><span class="line">//    basicAnimation.delegate=self;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    //4.添加动画到图层，注意key相当于给动画进行命名，以后获得该动画时可以使用此名称获取</span><br><span class="line">    [_layer addAnimation:basicAnimation forKey:@&quot;KCBasicAnimation_Rotation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 点击事件</span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    UITouch *touch=touches.anyObject;</span><br><span class="line">    CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    //判断是否已经创建过动画，如果已经创建则不再创建动画</span><br><span class="line">    CAAnimation *animation= [_layer animationForKey:@&quot;KCBasicAnimation_Translation&quot;];</span><br><span class="line">    if(animation)&#123;</span><br><span class="line">        if (_layer.speed==0) &#123;</span><br><span class="line">            [self animationResume];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            [self animationPause];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        //创建并开始动画</span><br><span class="line">        [self translatonAnimation:location];</span><br><span class="line">        </span><br><span class="line">        [self rotationAnimation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 动画暂停</span><br><span class="line">-(void)animationPause&#123;</span><br><span class="line">    //取得指定图层动画的媒体时间，后面参数用于指定子图层，这里不需要</span><br><span class="line">    CFTimeInterval interval=[_layer convertTime:CACurrentMediaTime() fromLayer:nil];</span><br><span class="line">    //设置时间偏移量，保证暂停时停留在旋转的位置</span><br><span class="line">    [_layer setTimeOffset:interval];</span><br><span class="line">    //速度设置为0，暂停动画</span><br><span class="line">    _layer.speed=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 动画恢复</span><br><span class="line">-(void)animationResume&#123;</span><br><span class="line">    //获得暂停的时间</span><br><span class="line">    CFTimeInterval beginTime= CACurrentMediaTime()- _layer.timeOffset;</span><br><span class="line">    //设置偏移量</span><br><span class="line">    _layer.timeOffset=0;</span><br><span class="line">    //设置开始时间</span><br><span class="line">    _layer.beginTime=beginTime;</span><br><span class="line">    //设置动画速度，开始运动</span><br><span class="line">    _layer.speed=1.0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 动画代理方法</span><br><span class="line">#pragma mark 动画开始</span><br><span class="line">-(void)animationDidStart:(CAAnimation *)anim&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) start.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    NSLog(@&quot;%@&quot;,[_layer animationForKey:@&quot;KCBasicAnimation_Translation&quot;]);//通过前面的设置的key获得动画</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 动画结束</span><br><span class="line">-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</span><br><span class="line">    NSLog(@&quot;animation(%@) stop.\r_layer.frame=%@&quot;,anim,NSStringFromCGRect(_layer.frame));</span><br><span class="line">    </span><br><span class="line">    //开启事务</span><br><span class="line">    [CATransaction begin];</span><br><span class="line">    //禁用隐式动画</span><br><span class="line">    [CATransaction setDisableActions:YES];</span><br><span class="line">    </span><br><span class="line">    _layer.position=[[anim valueForKey:@&quot;KCBasicAnimationLocation&quot;] CGPointValue];</span><br><span class="line">    </span><br><span class="line">    //提交事务</span><br><span class="line">    [CATransaction commit];</span><br><span class="line">    </span><br><span class="line">    //暂停动画</span><br><span class="line">    [self animationPause];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>运行效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-f627e183ce0a4381.gif?imageMogr2/auto-orient/strip" alt=""></p>
<blockquote>
<p>注意：<br>动画暂停针对的是图层而不是图层中的某个动画。<br>要做无限循环的动画，动画的removedOnCompletion属性必须设置为NO，否则运行一次动画就会销毁。</p>
</blockquote>
<p>##关键帧动画</p>
<p>熟悉flash开发的朋友对于关键帧动画应该不陌生，这种动画方式在flash开发中经常用到。关键帧动画就是在动画控制过程中开发者指定主要的动画状态，至于各个状态间动画如何进行则由系统自动运算补充（每两个关键帧之间系统形成的动画称为“补间动画”），这种动画的好处就是开发者不用逐个控制每个动画帧，而只要关心几个关键帧的状态即可。</p>
<p>关键帧动画开发分为两种形式：一种是通过设置不同的属性值进行关键帧控制，另一种是通过绘制路径进行关键帧控制。后者优先级高于前者，如果设置了路径则属性值就不再起作用。</p>
<p>对于前面的落花动画效果而言其实落花的过程并不自然，很显然实际生活中它不可能沿着直线下落，这里我们不妨通过关键帧动画的values属性控制它在下落过程中的属性。假设下落过程如图：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-c4ffa126403764fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>在这里需要设置四个关键帧（如图中四个关键点），具体代码如下（动画创建过程同基本动画基本完全一致）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line"></span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">    </span><br><span class="line">    //创建动画</span><br><span class="line">    [self translationAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 关键帧动画</span><br><span class="line">-(void)translationAnimation&#123;</span><br><span class="line">    //1.创建关键帧动画并设置动画属性</span><br><span class="line">    CAKeyframeAnimation *keyframeAnimation=[CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置关键帧,这里有四个关键帧</span><br><span class="line">    NSValue *key1=[NSValue valueWithCGPoint:_layer.position];//对于关键帧动画初始值不能省略</span><br><span class="line">    NSValue *key2=[NSValue valueWithCGPoint:CGPointMake(80, 220)];</span><br><span class="line">    NSValue *key3=[NSValue valueWithCGPoint:CGPointMake(45, 300)];</span><br><span class="line">    NSValue *key4=[NSValue valueWithCGPoint:CGPointMake(55, 400)];</span><br><span class="line">    NSArray *values=@[key1,key2,key3,key4];</span><br><span class="line">    keyframeAnimation.values=values;</span><br><span class="line">    //设置其他属性</span><br><span class="line">    keyframeAnimation.duration=8.0;</span><br><span class="line">    keyframeAnimation.beginTime=CACurrentMediaTime()+2;//设置延迟2秒执行</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //3.添加动画到图层，添加动画后就会执行动画</span><br><span class="line">    [_layer addAnimation:keyframeAnimation forKey:@&quot;KCKeyframeAnimation_Position&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行效果(注意运行结束没有设置图层位置为动画运动结束位置)：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-941247dd1569c6df.gif?imageMogr2/auto-orient/strip" alt=""><br>上面的方式固然比前面使用基础动画效果要好一些，但其实还是存在问题，那就是落花飞落的路径是直线的，当然这个直线是根据程序中设置的四个关键帧自动形成的，那么如何让它沿着曲线飘落呢？这就是第二种类型的关键帧动画，通过描绘路径进行关键帧动画控制。假设让落花沿着下面的曲线路径飘落：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-b4e8e00aa8a85236.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>当然，这是一条贝塞尔曲线，学习了前篇文章之后相信对于这类曲线应该并不陌生，下面是具体实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line">    </span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">    </span><br><span class="line">    //创建动画</span><br><span class="line">    [self translationAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 关键帧动画</span><br><span class="line">-(void)translationAnimation&#123;</span><br><span class="line">    //1.创建关键帧动画并设置动画属性</span><br><span class="line">    CAKeyframeAnimation *keyframeAnimation=[CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    //2.设置路径</span><br><span class="line">    //绘制贝塞尔曲线</span><br><span class="line">    CGPathRef path=CGPathCreateMutable();</span><br><span class="line">    CGPathMoveToPoint(path, NULL, _layer.position.x, _layer.position.y);//移动到起始点</span><br><span class="line">    CGPathAddCurveToPoint(path, NULL, 160, 280, -30, 300, 55, 400);//绘制二次贝塞尔曲线</span><br><span class="line"></span><br><span class="line">    keyframeAnimation.path=path;//设置path属性</span><br><span class="line">    CGPathRelease(path);//释放路径对象</span><br><span class="line">    //设置其他属性</span><br><span class="line">    keyframeAnimation.duration=8.0;</span><br><span class="line">    keyframeAnimation.beginTime=CACurrentMediaTime()+5;//设置延迟2秒执行</span><br><span class="line">    </span><br><span class="line">    //3.添加动画到图层，添加动画后就会执行动画</span><br><span class="line">    [_layer addAnimation:keyframeAnimation forKey:@&quot;KCKeyframeAnimation_Position&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行效果(注意运行结束没有设置图层位置为动画运动结束位置)：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-2d9d35fbcc89e9a8.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>看起来动画不会那么生硬了，但是这里需要注意，对于路径类型的关键帧动画系统是从描绘路径的位置开始路径，直到路径结束。如果上面的路径不是贝塞尔曲线而是矩形路径那么它会从矩形的左上角开始运行，顺时针一周回到左上角；如果指定的路径是一个椭圆，那么动画运行的路径是从椭圆右侧开始（0度）顺时针一周回到右侧。</p>
<p>####补充–其他属性</p>
<p>在关键帧动画中还有一些动画属性初学者往往比较容易混淆，这里专门针对这些属性做一下介绍。</p>
<p>keyTimes：各个关键帧的时间控制。前面使用values设置了四个关键帧，默认情况下每两帧之间的间隔为:8/(4-1)秒。如果想要控制动画从第一帧到第二针占用时间4秒，从第二帧到第三帧时间为2秒，而从第三帧到第四帧时间2秒的话，就可以通过keyTimes进行设置。keyTimes中存储的是时间占用比例点，此时可以设置keyTimes的值为0.0，0.5，0.75，1.0（当然必须转换为NSNumber），也就是说1到2帧运行到总时间的50%，2到3帧运行到总时间的75%，3到4帧运行到8秒结束。</p>
<p>caculationMode：动画计算模式。还拿上面keyValues动画举例，之所以1到2帧能形成连贯性动画而不是直接从第1帧经过8/3秒到第2帧是因为动画模式是连续的（值为kCAAnimationLinear，这是计算模式的默认值）；而如果指定了动画模式为kCAAnimationDiscrete离散的那么你会看到动画从第1帧经过8/3秒直接到第2帧，中间没有任何过渡。其他动画模式还有：kCAAnimationPaced（均匀执行，会忽略keyTimes）、kCAAnimationCubic（平滑执行，对于位置变动关键帧动画运行轨迹更平滑）、kCAAnimationCubicPaced（平滑均匀执行）。</p>
<p>下图描绘出了几种动画模式的关系（横坐标是运行时间，纵坐标是动画属性[例如位置、透明度等]）：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-dd25d87f7b76f972.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>###动画组<br>实际开发中一个物体的运动往往是复合运动，单一属性的运动情况比较少，但恰恰属性动画每次进行动画设置时一次只能设置一个属性进行动画控制(不管是基础动画还是关键帧动画都是如此)，这样一来要做一个复合运动的动画就必须创建多个属性动画进行组合。对于一两种动画的组合或许处理起来还比较容易，但是对于更多动画的组合控制往往会变得很麻烦，动画组的产生就是基于这样一种情况而产生的。动画组是一系列动画的组合，凡是添加到动画组中的动画都受控于动画组，这样一来各类动画公共的行为就可以统一进行控制而不必单独设置，而且放到动画组中的各个动画可以并发执行，共同构建出复杂的动画效果。</p>
<p>动画组使用起来并不复杂，首先单独创建单个动画（可以是基础动画也可以是关键帧动画），然后将基础动画添加到动画组，最后将动画组添加到图层即可。</p>
<p>前面关键帧动画部分，路径动画看起来效果虽然很流畅，但是落花本身的旋转运动没有了，这里不妨将基础动画部分的旋转动画和路径关键帧动画进行组合使得整个动画看起来更加的和谐、顺畅。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景(注意这个图片其实在根图层)</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line">    </span><br><span class="line">    //自定义一个图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 10, 20);</span><br><span class="line">    _layer.position=CGPointMake(50, 150);</span><br><span class="line">    _layer.contents=(id)[UIImage imageNamed:@&quot;petal.png&quot;].CGImage;</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">    </span><br><span class="line">    //创建动画</span><br><span class="line">    [self groupAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 基础旋转动画</span><br><span class="line">-(CABasicAnimation *)rotationAnimation&#123;</span><br><span class="line"></span><br><span class="line">    CABasicAnimation *basicAnimation=[CABasicAnimation animationWithKeyPath:@&quot;transform.rotation.z&quot;];</span><br><span class="line"></span><br><span class="line">    CGFloat toValue=M_PI_2*3;</span><br><span class="line">    basicAnimation.toValue=[NSNumber numberWithFloat:M_PI_2*3];</span><br><span class="line"></span><br><span class="line">//    basicAnimation.duration=6.0;</span><br><span class="line">    basicAnimation.autoreverses=true;</span><br><span class="line">    basicAnimation.repeatCount=HUGE_VALF;</span><br><span class="line">    basicAnimation.removedOnCompletion=NO;</span><br><span class="line">    </span><br><span class="line">    [basicAnimation setValue:[NSNumber numberWithFloat:toValue] forKey:@&quot;KCBasicAnimationProperty_ToValue&quot;];</span><br><span class="line">    </span><br><span class="line">    return basicAnimation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 关键帧移动动画</span><br><span class="line">-(CAKeyframeAnimation *)translationAnimation&#123;</span><br><span class="line">    CAKeyframeAnimation *keyframeAnimation=[CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    </span><br><span class="line">    CGPoint endPoint= CGPointMake(55, 400);</span><br><span class="line">    CGPathRef path=CGPathCreateMutable();</span><br><span class="line">    CGPathMoveToPoint(path, NULL, _layer.position.x, _layer.position.y);</span><br><span class="line">    CGPathAddCurveToPoint(path, NULL, 160, 280, -30, 300, endPoint.x, endPoint.y);</span><br><span class="line">    </span><br><span class="line">    keyframeAnimation.path=path;</span><br><span class="line">    CGPathRelease(path);</span><br><span class="line"></span><br><span class="line">    [keyframeAnimation setValue:[NSValue valueWithCGPoint:endPoint] forKey:@&quot;KCKeyframeAnimationProperty_EndPosition&quot;];</span><br><span class="line">    </span><br><span class="line">    return keyframeAnimation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 创建动画组</span><br><span class="line">-(void)groupAnimation&#123;</span><br><span class="line">    //1.创建动画组</span><br><span class="line">    CAAnimationGroup *animationGroup=[CAAnimationGroup animation];</span><br><span class="line">    </span><br><span class="line">    //2.设置组中的动画和其他属性</span><br><span class="line">    CABasicAnimation *basicAnimation=[self rotationAnimation];</span><br><span class="line">    CAKeyframeAnimation *keyframeAnimation=[self translationAnimation];</span><br><span class="line">    animationGroup.animations=@[basicAnimation,keyframeAnimation];</span><br><span class="line">    </span><br><span class="line">    animationGroup.delegate=self;</span><br><span class="line">    animationGroup.duration=10.0;//设置动画时间，如果动画组中动画已经设置过动画属性则不再生效</span><br><span class="line">    animationGroup.beginTime=CACurrentMediaTime()+5;//延迟五秒执行</span><br><span class="line">    </span><br><span class="line">    //3.给图层添加动画</span><br><span class="line">    [_layer addAnimation:animationGroup forKey:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 代理方法</span><br><span class="line">#pragma mark 动画完成</span><br><span class="line">-(void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</span><br><span class="line">    CAAnimationGroup *animationGroup=(CAAnimationGroup *)anim;</span><br><span class="line">    CABasicAnimation *basicAnimation=animationGroup.animations[0];</span><br><span class="line">    CAKeyframeAnimation *keyframeAnimation=animationGroup.animations[1];</span><br><span class="line">    CGFloat toValue=[[basicAnimation valueForKey:@&quot;KCBasicAnimationProperty_ToValue&quot;] floatValue];</span><br><span class="line">    CGPoint endPoint=[[keyframeAnimation valueForKey:@&quot;KCKeyframeAnimationProperty_EndPosition&quot;] CGPointValue];</span><br><span class="line">    </span><br><span class="line">    [CATransaction begin];</span><br><span class="line">    [CATransaction setDisableActions:YES];</span><br><span class="line">    </span><br><span class="line">    //设置动画最终状态</span><br><span class="line">    _layer.position=endPoint;</span><br><span class="line">    _layer.transform=CATransform3DMakeRotation(toValue, 0, 0, 1);</span><br><span class="line">    </span><br><span class="line">    [CATransaction commit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-f92b3b46d64b191c.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>####转场动画<br>转场动画就是从一个场景以动画的形式过渡到另一个场景。转场动画的使用一般分为以下几个步骤：</p>
<ol>
<li><p>创建转场动画</p>
</li>
<li><p>设置转场类型、子类型（可选）及其他属性</p>
</li>
<li><p>设置转场后的新视图并添加动画到图层</p>
</li>
</ol>
<p>下表列出了常用的转场类型(注意私有API是苹果官方没有公开的动画类型，但是目前通过仍然可以使用)：</p>
<table>
<thead>
<tr>
<th>动画类型</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">对应常量</th>
<th>是否支持方向设置     </th>
</tr>
</thead>
<tbody>
<tr>
<td>公开API</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td></td>
</tr>
<tr>
<td>fade</td>
<td style="text-align:center">淡出效果</td>
<td style="text-align:center">kCATransitionFade</td>
<td>是</td>
</tr>
<tr>
<td>movein</td>
<td style="text-align:center">新视图移动到旧视图上</td>
<td style="text-align:center">kCATransitionMoveIn</td>
<td>是</td>
</tr>
<tr>
<td>push</td>
<td style="text-align:center">新视图推出旧视图</td>
<td style="text-align:center">kCATransitionPush</td>
<td>是</td>
</tr>
<tr>
<td>reveal</td>
<td style="text-align:center">移开旧视图显示新视图</td>
<td style="text-align:center">kCATransitionReveal</td>
<td>是</td>
</tr>
<tr>
<td>私有API</td>
<td style="text-align:center"></td>
<td style="text-align:center">私有API只能通过字符串访问</td>
<td></td>
</tr>
<tr>
<td>cube</td>
<td style="text-align:center">立方体翻转效果</td>
<td style="text-align:center">无</td>
<td>是</td>
</tr>
<tr>
<td>oglFlip</td>
<td style="text-align:center">翻转效果</td>
<td style="text-align:center">无</td>
<td>是</td>
</tr>
<tr>
<td>suckEffect</td>
<td style="text-align:center">收缩效果</td>
<td style="text-align:center">无</td>
<td>否</td>
</tr>
<tr>
<td>rippleEffect</td>
<td style="text-align:center">水滴波纹效果</td>
<td style="text-align:center">无</td>
<td>否</td>
</tr>
<tr>
<td>pageCurl</td>
<td style="text-align:center">向上翻页效果</td>
<td style="text-align:center">无</td>
<td>是</td>
</tr>
<tr>
<td>pageUnCurl</td>
<td style="text-align:center">向下翻页效果</td>
<td style="text-align:center">无</td>
<td>是</td>
</tr>
<tr>
<td>cameralIrisHollowOpen</td>
<td style="text-align:center">摄像头打开效果</td>
<td style="text-align:center">无</td>
<td>否</td>
</tr>
<tr>
<td>cameraIrisHollowClose</td>
<td style="text-align:center">摄像头关闭效果</td>
<td style="text-align:center">无</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>另外对于支持方向设置的动画类型还包含子类型：</p>
<table>
<thead>
<tr>
<th style="text-align:left">动画子类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">kCATransitionFromRight</td>
<td style="text-align:center">从右侧转场</td>
</tr>
<tr>
<td style="text-align:left">kCATransitionFromLeft</td>
<td style="text-align:center">从左侧转场</td>
</tr>
<tr>
<td style="text-align:left">kCATransitionFromTop</td>
<td style="text-align:center">从顶部转场</td>
</tr>
<tr>
<td style="text-align:left">kCATransitionFromBottom</td>
<td style="text-align:center">从底部转场</td>
</tr>
</tbody>
</table>
<p>使用转场动画利用一个UIImageView实现一个漂亮的无限循环图片浏览器:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line">#define IMAGE_COUNT 5</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    UIImageView *_imageView;</span><br><span class="line">    int _currentIndex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //定义图片控件</span><br><span class="line">    _imageView=[[UIImageView alloc]init];</span><br><span class="line">    _imageView.frame=[UIScreen mainScreen].bounds;</span><br><span class="line">    _imageView.contentMode=UIViewContentModeScaleAspectFit;</span><br><span class="line">    _imageView.image=[UIImage imageNamed:@&quot;0.jpg&quot;];//默认图片</span><br><span class="line">    [self.view addSubview:_imageView];</span><br><span class="line">    //添加手势</span><br><span class="line">    UISwipeGestureRecognizer *leftSwipeGesture=[[UISwipeGestureRecognizer alloc]initWithTarget:self action:@selector(leftSwipe:)];</span><br><span class="line">    leftSwipeGesture.direction=UISwipeGestureRecognizerDirectionLeft;</span><br><span class="line">    [self.view addGestureRecognizer:leftSwipeGesture];</span><br><span class="line">    </span><br><span class="line">    UISwipeGestureRecognizer *rightSwipeGesture=[[UISwipeGestureRecognizer alloc]initWithTarget:self action:@selector(rightSwipe:)];</span><br><span class="line">    rightSwipeGesture.direction=UISwipeGestureRecognizerDirectionRight;</span><br><span class="line">    [self.view addGestureRecognizer:rightSwipeGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 向左滑动浏览下一张图片</span><br><span class="line">-(void)leftSwipe:(UISwipeGestureRecognizer *)gesture&#123;</span><br><span class="line">    [self transitionAnimation:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 向右滑动浏览上一张图片</span><br><span class="line">-(void)rightSwipe:(UISwipeGestureRecognizer *)gesture&#123;</span><br><span class="line">    [self transitionAnimation:NO];</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark 转场动画</span><br><span class="line">-(void)transitionAnimation:(BOOL)isNext&#123;</span><br><span class="line">    //1.创建转场动画对象</span><br><span class="line">    CATransition *transition=[[CATransition alloc]init];</span><br><span class="line">    </span><br><span class="line">    //2.设置动画类型,注意对于苹果官方没公开的动画类型只能使用字符串，并没有对应的常量定义</span><br><span class="line">    transition.type=@&quot;cube&quot;;</span><br><span class="line">    </span><br><span class="line">    //设置子类型</span><br><span class="line">    if (isNext) &#123;</span><br><span class="line">        transition.subtype=kCATransitionFromRight;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        transition.subtype=kCATransitionFromLeft;</span><br><span class="line">    &#125;</span><br><span class="line">    //设置动画时常</span><br><span class="line">    transition.duration=1.0f;</span><br><span class="line">    </span><br><span class="line">    //3.设置转场后的新视图添加转场动画</span><br><span class="line">    _imageView.image=[self getImage:isNext];</span><br><span class="line">    [_imageView.layer addAnimation:transition forKey:@&quot;KCTransitionAnimation&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 取得当前图片</span><br><span class="line">-(UIImage *)getImage:(BOOL)isNext&#123;</span><br><span class="line">    if (isNext) &#123;</span><br><span class="line">        _currentIndex=(_currentIndex+1)%IMAGE_COUNT;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        _currentIndex=(_currentIndex-1+IMAGE_COUNT)%IMAGE_COUNT;</span><br><span class="line">    &#125;</span><br><span class="line">    NSString *imageName=[NSString stringWithFormat:@&quot;%i.jpg&quot;,_currentIndex];</span><br><span class="line">    return [UIImage imageNamed:imageName];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2647951-ba1b6c3e258a2592.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>代码十分简单，但是效果和性能却很惊人。当然演示代码有限，其他动画类型大家可以自己实现，效果都很绚丽。</p>
<p>##逐帧动画</p>
<p>前面介绍了核心动画中大部分动画类型，但是做过动画处理的朋友都知道，在动画制作中还有一种动画类型“逐帧动画”。说到逐帧动画相信很多朋友第一个想到的就是UIImageView，通过设置UIImageView的animationImages属性，然后调用它的startAnimating方法去播放这组图片。当然这种方法在某些场景下是可以达到逐帧的动画效果，但是它也存在着很大的性能问题，并且这种方法一旦设置完图片中间的过程就无法控制了。当然，也许有朋友会想到利用iOS的定时器NSTimer定时更新图片来达到逐帧动画的效果。这种方式确实可以解决UIImageView一次性加载大量图片的问题，而且让播放过程可控，唯一的缺点就是定时器方法调用有时可能会因为当前系统执行某种比较占用时间的任务造成动画连续性出现问题。</p>
<p>虽然在核心动画没有直接提供逐帧动画类型，但是却提供了用于完成逐帧动画的相关对象CADisplayLink。CADisplayLink是一个计时器，但是同NSTimer不同的是，CADisplayLink的刷新周期同屏幕完全一致。例如在iOS中屏幕刷新周期是60次/秒，CADisplayLink刷新周期同屏幕刷新一致也是60次/秒，这样一来使用它完成的逐帧动画（又称为“时钟动画”）完全感觉不到动画的停滞情况。</p>
<p>iOS程序在运行后就进入一个消息循环中（这个消息循环称为“主运行循环”），整个程序相当于进入一个死循环中，始终等待用户输入。将CADisplayLink加入到主运行循环队列后，它的时钟周期就和主运行循环保持一致，而主运行循环周期就是屏幕刷新周期。在CADisplayLink加入到主运行循环队列后就会循环调用目标方法，在这个方法中更新视图内容就可以完成逐帧动画。</p>
<p>当然这里不得不强调的是逐帧动画性能势必较低，但是对于一些事物的运动又不得不选择使用逐帧动画，例如人的运动，这是一个高度复杂的运动，基本动画、关键帧动画是不可能解决的。所大家一定要注意在循环方法中尽可能的降低算法复杂度，同时保证循环过程中内存峰值尽可能低。下面以一个鱼的运动为例为大家演示一下逐帧动画。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line">#define IMAGE_COUNT 10</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    CALayer *_layer;</span><br><span class="line">    int _index;</span><br><span class="line">    NSMutableArray *_images;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景</span><br><span class="line">    self.view.layer.contents=(id)[UIImage imageNamed:@&quot;bg.png&quot;].CGImage;</span><br><span class="line">    </span><br><span class="line">    //创建图像显示图层</span><br><span class="line">    _layer=[[CALayer alloc]init];</span><br><span class="line">    _layer.bounds=CGRectMake(0, 0, 87, 32);</span><br><span class="line">    _layer.position=CGPointMake(160, 284);</span><br><span class="line">    [self.view.layer addSublayer:_layer];</span><br><span class="line">    </span><br><span class="line">    //由于鱼的图片在循环中会不断创建，而10张鱼的照片相对都很小</span><br><span class="line">    //与其在循环中不断创建UIImage不如直接将10张图片缓存起来</span><br><span class="line">    _images=[NSMutableArray array];</span><br><span class="line">    for (int i=0; i&lt;10; ++i) &#123;</span><br><span class="line">        NSString *imageName=[NSString stringWithFormat:@&quot;fish%i.png&quot;,i];</span><br><span class="line">        UIImage *image=[UIImage imageNamed:imageName];</span><br><span class="line">        [_images addObject:image];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    //定义时钟对象</span><br><span class="line">    CADisplayLink *displayLink=[CADisplayLink displayLinkWithTarget:self selector:@selector(step)];</span><br><span class="line">    //添加时钟对象到主运行循环</span><br><span class="line">    [displayLink addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSDefaultRunLoopMode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 每次屏幕刷新就会执行一次此方法(每秒接近60次)</span><br><span class="line">-(void)step&#123;</span><br><span class="line">    //定义一个变量记录执行次数</span><br><span class="line">    static int s=0;</span><br><span class="line">    //每秒执行6次</span><br><span class="line">    if (++s%10==0) &#123;</span><br><span class="line">        UIImage *image=_images[_index];</span><br><span class="line">        _layer.contents=(id)image.CGImage;//更新图片</span><br><span class="line">        _index=(_index+1)%IMAGE_COUNT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2647951-9e8bf685bb3c9e6a.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>注意：上面仅仅演示了逐帧动画的过程，事实上结合其他动画类型可以让整条鱼游动起来，这里不再赘述。</p>
<p>##UIView动画封装<br>有了前面核心动画的知识，相信大家开发出一般的动画效果应该不在话下。在核心动画开篇也给大家说过，其实UIView本身对于基本动画和关键帧动画、转场动画都有相应的封装，在对动画细节没有特殊要求的情况下使用起来也要简单的多。可以说在日常开发中90%以上的情况使用UIView的动画封装方法都可以搞定，因此在熟悉了核心动画的原理之后还是有必要给大家简单介绍一下UIView中各类动画使用方法的。由于前面核心动画内容已经进行过详细介绍，学习UIView的封装方法根本是小菜一碟，这里对于一些细节就不再赘述了。</p>
<p>##基础动画</p>
<p>基础动画部分和前面的基础动画演示相对应，演示点击屏幕落叶飘落到鼠标点击位置的过程。注意根据前面介绍的隐式动画知识其实非根图层直接设置终点位置不需要使用UIView的动画方法也可以实现动画效果，因此这里落花不再放到图层中而是放到了一个UIImageView中。</p>
<p>下面的代码演示了通过block和静态方法实现动画控制的过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    UIImageView *_imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line"></span><br><span class="line">    //设置背景</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line"></span><br><span class="line">    //创建图像显示控件</span><br><span class="line">    _imageView=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@&quot;petal.png&quot;]];</span><br><span class="line">    _imageView.center=CGPointMake(50, 150);</span><br><span class="line">    [self.view addSubview:_imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 点击事件</span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    UITouch *touch=touches.anyObject;</span><br><span class="line">    CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    //方法1：block方式</span><br><span class="line">    /*开始动画，UIView的动画方法执行完后动画会停留在重点位置，而不需要进行任何特殊处理</span><br><span class="line">     duration:执行时间</span><br><span class="line">     delay:延迟时间</span><br><span class="line">     options:动画设置，例如自动恢复、匀速运动等</span><br><span class="line">     completion:动画完成回调方法</span><br><span class="line">     */</span><br><span class="line">//    [UIView animateWithDuration:5.0 delay:0 options:UIViewAnimationOptionCurveLinear animations:^&#123;</span><br><span class="line">//        _imageView.center=location;</span><br><span class="line">//    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">//        NSLog(@&quot;Animation end.&quot;);</span><br><span class="line">//    &#125;];</span><br><span class="line">    </span><br><span class="line">    //方法2：静态方法,较方法1好些</span><br><span class="line">    //开始动画</span><br><span class="line">    [UIView beginAnimations:@&quot;KCBasicAnimation&quot; context:nil];</span><br><span class="line">    [UIView setAnimationDuration:5.0];</span><br><span class="line">    //[UIView setAnimationDelay:1.0];//设置延迟</span><br><span class="line">    //[UIView setAnimationRepeatAutoreverses:NO];//是否回复</span><br><span class="line">    //[UIView setAnimationRepeatCount:10];//重复次数</span><br><span class="line">    //[UIView setAnimationStartDate:(NSDate *)];//设置动画开始运行的时间</span><br><span class="line">    //[UIView setAnimationDelegate:self];//设置代理</span><br><span class="line">    //[UIView setAnimationWillStartSelector:(SEL)];//设置动画开始运动的执行方法</span><br><span class="line">    //[UIView setAnimationDidStopSelector:(SEL)];//设置动画运行结束后的执行方法</span><br><span class="line">    </span><br><span class="line">    _imageView.center=location;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //开始动画</span><br><span class="line">    [UIView commitAnimations];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>补充–弹簧动画效果</p>
<p>由于在iOS开发中弹性动画使用很普遍，所以在iOS7苹果官方直接提供了一个方法用于弹性动画开发，下面简单的演示一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    UIImageView *_imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line"></span><br><span class="line">    //创建图像显示控件</span><br><span class="line">    _imageView=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@&quot;ball.png&quot;]];</span><br><span class="line">    _imageView.center=CGPointMake(160, 50);</span><br><span class="line">    [self.view addSubview:_imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 点击事件</span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    UITouch *touch=touches.anyObject;</span><br><span class="line">    CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    /*创建弹性动画</span><br><span class="line">     damping:阻尼，范围0-1，值越小阻尼越小，阻尼越接近于0，弹性效果越明显</span><br><span class="line">     velocity:弹性复位的速度，越大速度越快</span><br><span class="line">    */</span><br><span class="line">    [UIView animateWithDuration:5.0 delay:0 usingSpringWithDamping:0.1 initialSpringVelocity:1.0 options:UIViewAnimationOptionCurveLinear animations:^&#123;</span><br><span class="line">        _imageView.center=location; //CGPointMake(160, 284);</span><br><span class="line">    &#125; completion:nil];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2647951-b62d4a6cfeaa9344.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p><strong>补充–动画设置参数</strong></p>
<p>在动画方法中有一个option参数，UIViewAnimationOptions类型，它是一个枚举类型，动画参数分为三类，可以组合使用：</p>
<ol>
<li><p>常规动画属性设置（可以同时选择多个进行设置）</p>
<blockquote>
<p>UIViewAnimationOptionLayoutSubviews：动画过程中保证子视图跟随运动。<br>UIViewAnimationOptionAllowUserInteraction：动画过程中允许用户交互。<br>UIViewAnimationOptionBeginFromCurrentState：所有视图从当前状态开始运行。<br>UIViewAnimationOptionRepeat：重复运行动画。<br>UIViewAnimationOptionAutoreverse ：动画运行到结束点后仍然以动画方式回到初始点。<br>UIViewAnimationOptionOverrideInheritedDuration：忽略嵌套动画时间设置。<br>UIViewAnimationOptionOverrideInheritedCurve：忽略嵌套动画速度设置。<br>UIViewAnimationOptionAllowAnimatedContent：动画过程中重绘视图（注意仅仅适用于转场动画）。<br>UIViewAnimationOptionShowHideTransitionViews：视图切换时直接隐藏旧视图、显示新视图，而不是将旧视图从父视图移除（仅仅适用于转场动画）<br>UIViewAnimationOptionOverrideInheritedOptions ：不继承父动画设置或动画类型。</p>
</blockquote>
</li>
<li><p>动画速度控制（可从其中选择一个设置）</p>
<blockquote>
<p>UIViewAnimationOptionCurveEaseInOut：动画开始缓慢，中间快，结束慢。<br>UIViewAnimationOptionCurveEaseIn ：动画开始慢，之后逐渐加速。<br>UIViewAnimationOptionCurveEaseOut：动画开始快，之后逐渐变慢。<br>UIViewAnimationOptionCurveLinear ：动画匀速执行，默认值。</p>
</blockquote>
</li>
<li><p>转场类型（仅适用于转场动画设置，可以从中选择一个进行设置，基本动画、关键帧动画不需要设置）</p>
<blockquote>
<p>UIViewAnimationOptionTransitionNone：没有转场动画效果。<br>UIViewAnimationOptionTransitionFlipFromLeft ：从左侧翻转效果。<br>UIViewAnimationOptionTransitionFlipFromRight：从右侧翻转效果。<br>UIViewAnimationOptionTransitionCurlUp：向后翻页的动画过渡效果。<br>UIViewAnimationOptionTransitionCurlDown ：向前翻页的动画过渡效果。<br>UIViewAnimationOptionTransitionCrossDissolve：旧视图溶解消失显示下一个新视图的效果。<br>UIViewAnimationOptionTransitionFlipFromTop ：从上方翻转效果。<br>UIViewAnimationOptionTransitionFlipFromBottom：从底部翻转效果。</p>
</blockquote>
</li>
</ol>
<p>###关键帧动画</p>
<p>从iOS7开始UIView动画中封装了关键帧动画，下面就来看一下如何使用UIView封装方法进行关键帧动画控制，这里实现前面关键帧动画部分对于落花的控制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    UIImageView *_imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //设置背景</span><br><span class="line">    UIImage *backgroundImage=[UIImage imageNamed:@&quot;background.jpg&quot;];</span><br><span class="line">    self.view.backgroundColor=[UIColor colorWithPatternImage:backgroundImage];</span><br><span class="line"></span><br><span class="line">    //创建图像显示控件</span><br><span class="line">    _imageView=[[UIImageView alloc]initWithImage:[UIImage imageNamed:@&quot;petal.png&quot;]];</span><br><span class="line">    _imageView.center=CGPointMake(50, 150);</span><br><span class="line">    [self.view addSubview:_imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event&#123;</span><br><span class="line">    //UITouch *touch=touches.anyObject;</span><br><span class="line">    //CGPoint location= [touch locationInView:self.view];</span><br><span class="line">    </span><br><span class="line">    /*关键帧动画</span><br><span class="line">     options:</span><br><span class="line">     */</span><br><span class="line">    [UIView animateKeyframesWithDuration:5.0 delay:0 options: UIViewKeyframeAnimationOptionCalculationModeLinear animations:^&#123;</span><br><span class="line">        //第二个关键帧（准确的说第一个关键帧是开始位置）:从0秒开始持续50%的时间，也就是5.0*0.5=2.5秒</span><br><span class="line">        [UIView addKeyframeWithRelativeStartTime:0.0 relativeDuration:0.5 animations:^&#123;</span><br><span class="line">            _imageView.center=CGPointMake(80.0, 220.0);</span><br><span class="line">        &#125;];</span><br><span class="line">        //第三个关键帧，从0.5*5.0秒开始，持续5.0*0.25=1.25秒</span><br><span class="line">        [UIView addKeyframeWithRelativeStartTime:0.5 relativeDuration:0.25 animations:^&#123;</span><br><span class="line">            _imageView.center=CGPointMake(45.0, 300.0);</span><br><span class="line">        &#125;];</span><br><span class="line">        //第四个关键帧：从0.75*5.0秒开始，持所需5.0*0.25=1.25秒</span><br><span class="line">        [UIView addKeyframeWithRelativeStartTime:0.75 relativeDuration:0.25 animations:^&#123;</span><br><span class="line">            _imageView.center=CGPointMake(55.0, 400.0);</span><br><span class="line">        &#125;];</span><br><span class="line">        </span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        NSLog(@&quot;Animation end.&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>补充–动画设置参数</strong></p>
<p>对于关键帧动画也有一些动画参数设置options，UIViewKeyframeAnimationOptions类型，和上面基本动画参数设置有些差别，关键帧动画设置参数分为两类，可以组合使用：</p>
<ol>
<li><p>常规动画属性设置（可以同时选择多个进行设置）</p>
<blockquote>
<p>UIViewAnimationOptionLayoutSubviews：动画过程中保证子视图跟随运动。<br>UIViewAnimationOptionAllowUserInteraction：动画过程中允许用户交互。<br>UIViewAnimationOptionBeginFromCurrentState：所有视图从当前状态开始运行。<br>UIViewAnimationOptionRepeat：重复运行动画。<br>UIViewAnimationOptionAutoreverse ：动画运行到结束点后仍然以动画方式回到初始点。<br>UIViewAnimationOptionOverrideInheritedDuration：忽略嵌套动画时间设置。<br>UIViewAnimationOptionOverrideInheritedOptions ：不继承父动画设置或动画类型。</p>
</blockquote>
</li>
<li><p>动画模式设置（同前面关键帧动画动画模式一一对应，可以从其中选择一个进行设置）</p>
<blockquote>
<p>UIViewKeyframeAnimationOptionCalculationModeLinear：连续运算模式。<br>UIViewKeyframeAnimationOptionCalculationModeDiscrete ：离散运算模式。<br>UIViewKeyframeAnimationOptionCalculationModePaced：均匀执行运算模式。<br>UIViewKeyframeAnimationOptionCalculationModeCubic：平滑运算模式。<br>UIViewKeyframeAnimationOptionCalculationModeCubicPaced：平滑均匀运算模式。</p>
</blockquote>
</li>
</ol>
<p><strong>注意：前面说过关键帧动画有两种形式，上面演示的是属性值关键帧动画，路径关键帧动画目前UIView还不支持。</strong></p>
<p>###转场动画</p>
<p>从iOS4.0开始，UIView直接封装了转场动画，使用起来同样很简单。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;KCMainViewController.h&quot;</span><br><span class="line">#define IMAGE_COUNT 5</span><br><span class="line"></span><br><span class="line">@interface KCMainViewController ()&#123;</span><br><span class="line">    UIImageView *_imageView;</span><br><span class="line">    int _currentIndex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation KCMainViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    //定义图片控件</span><br><span class="line">    _imageView=[[UIImageView alloc]init];</span><br><span class="line">    _imageView.frame=[UIScreen mainScreen].bounds;</span><br><span class="line">    _imageView.contentMode=UIViewContentModeScaleAspectFit;</span><br><span class="line">    _imageView.image=[UIImage imageNamed:@&quot;0.jpg&quot;];//默认图片</span><br><span class="line">    [self.view addSubview:_imageView];</span><br><span class="line">    //添加手势</span><br><span class="line">    UISwipeGestureRecognizer *leftSwipeGesture=[[UISwipeGestureRecognizer alloc]initWithTarget:self action:@selector(leftSwipe:)];</span><br><span class="line">    leftSwipeGesture.direction=UISwipeGestureRecognizerDirectionLeft;</span><br><span class="line">    [self.view addGestureRecognizer:leftSwipeGesture];</span><br><span class="line">    </span><br><span class="line">    UISwipeGestureRecognizer *rightSwipeGesture=[[UISwipeGestureRecognizer alloc]initWithTarget:self action:@selector(rightSwipe:)];</span><br><span class="line">    rightSwipeGesture.direction=UISwipeGestureRecognizerDirectionRight;</span><br><span class="line">    [self.view addGestureRecognizer:rightSwipeGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 向左滑动浏览下一张图片</span><br><span class="line">-(void)leftSwipe:(UISwipeGestureRecognizer *)gesture&#123;</span><br><span class="line">    [self transitionAnimation:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 向右滑动浏览上一张图片</span><br><span class="line">-(void)rightSwipe:(UISwipeGestureRecognizer *)gesture&#123;</span><br><span class="line">    [self transitionAnimation:NO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark 转场动画</span><br><span class="line">-(void)transitionAnimation:(BOOL)isNext&#123;</span><br><span class="line">    UIViewAnimationOptions option;</span><br><span class="line">    if (isNext) &#123;</span><br><span class="line">        option=UIViewAnimationOptionCurveLinear|UIViewAnimationOptionTransitionFlipFromRight;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        option=UIViewAnimationOptionCurveLinear|UIViewAnimationOptionTransitionFlipFromLeft;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [UIView transitionWithView:_imageView duration:1.0 options:option animations:^&#123;</span><br><span class="line">        _imageView.image=[self getImage:isNext];</span><br><span class="line">    &#125; completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark 取得当前图片</span><br><span class="line">-(UIImage *)getImage:(BOOL)isNext&#123;</span><br><span class="line">    if (isNext) &#123;</span><br><span class="line">        _currentIndex=(_currentIndex+1)%IMAGE_COUNT;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        _currentIndex=(_currentIndex-1+IMAGE_COUNT)%IMAGE_COUNT;</span><br><span class="line">    &#125;</span><br><span class="line">    NSString *imageName=[NSString stringWithFormat:@&quot;%i.jpg&quot;,_currentIndex];</span><br><span class="line">    return [UIImage imageNamed:imageName];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>上面的转场动画演示中，其实仅仅有一个视图UIImageView做转场动画，每次转场通过切换UIImageView的内容而已。如果有两个完全不同的视图，并且每个视图布局都很复杂，此时要在这两个视图之间进行转场可以使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+(void)transitionFromView:(UIView*)fromView toView:(UIView*)toView duration:(NSTimeInterval)duration options:(UIViewAnimationOptions)options completion:(void (^)(BOOL finished))completion NS_AVAILABLE_IOS(4_0)</span><br></pre></td></tr></table></figure></p>
<p>方法进行两个视图间的转场，需要注意的是默认情况下转出的视图会从父视图移除，转入后重新添加，可以通过UIViewAnimationOptionShowHideTransitionViews参数设置，设置此参数后转出的视图会隐藏（不会移除）转入后再显示。</p>
<p><strong>注意：转场动画设置参数完全同基本动画参数设置；同直接使用转场动画不同的是使用UIView的装饰方法进行转场动画其动画效果较少，因为这里无法直接使用私有API。</strong></p>
<p>上一篇：<a href="http://www.jianshu.com/p/55f49ae46e3d" target="_blank" rel="noopener">iOS开发系列:让你的应用“动”起来–CALayer</a><br>下一篇：<a href="http://www.jianshu.com/p/ed48bd11b5db" target="_blank" rel="noopener">iOS开发之多线程GCD</a></p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2018/04/24/iOS开发系列-让你的应用“动”起来--CALayer/" data-toggle="tooltip" data-placement="top"
                           title="iOS开发系列-让你的应用“动”起来--CALayer">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2018/04/24/iOS-copy与strong声明属性时的区别/" data-toggle="tooltip" data-placement="top"
                           title="iOS-copy与strong声明属性时的区别">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                
            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Kasign 2018
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                    Github by <a href="https://github.com/Kasign">Kasign</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="../../../../js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="../../../../js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="../../../../js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://kasign.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="/img/avatar.jpg">
</body>

</html>
